<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nofi.vn</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800&family=Merriweather:wght@900&display=swap" rel="stylesheet">

<style>
/* ===== THEME TOKENS ===== */
:root{
  --fg:#eae9e5; --muted:#a8b0ba;
  --panel:rgba(255,255,255,.06); --border:rgba(255,255,255,.14);
  --accent:#7dd3fc; --accent2:#a78bfa;
  --bg1:#1a2440; --bg2:#0b0f14; --bg3:#07090c;
  --link:#8ddcff; --placeholder:rgba(234,233,229,.55);
  --readerBg:rgba(18,22,27,.92);
}
:root[data-theme="sepia"]{
  --fg:#2a2016; --muted:#6a5741;
  --panel:#fffdf7; --border:#e2d5bf;
  --accent:#d97706; --accent2:#a16207;
  --bg1:#f7efdf; --bg2:#f1e6d2; --bg3:#eadcc4;
  --link:#b45309; --placeholder:rgba(42,32,22,.45);
  --readerBg:#fffdf7;
}
:root[data-theme="neon"]{
  --fg:#eceaff; --muted:#bfbaff;
  --panel:rgba(93,0,255,.22); --border:rgba(197,171,255,.35);
  --accent:#22d3ee; --accent2:#a855f7;
  --bg1:#12022b; --bg2:#0b0122; --bg3:#07001a;
  --link:#67e8f9; --placeholder:rgba(236,234,255,.55);
  --readerBg:rgba(18,22,27,.92);
}

/* ===== BASE ===== */
html,body{
  margin:0;padding:0;width:100%;min-height:100%;
  background:radial-gradient(1200px 1200px at 10% -10%, var(--bg1) 0%, var(--bg2) 40%, var(--bg3) 100%);
  color:var(--fg); font:15.5px/1.65 "Inter",system-ui,sans-serif;
  -webkit-text-size-adjust:none; text-size-adjust:none;
}

/* blobs */
.blob{position:fixed;inset:auto auto -22% -12%;width:60vmax;height:60vmax;
  background:radial-gradient(circle at 30% 30%,rgba(125,211,252,.25),transparent 60%);
  filter:blur(40px);pointer-events:none;animation:float 18s ease-in-out infinite alternate;z-index:0}
.blob.b2{inset:-18% -12% auto auto;width:55vmax;height:55vmax;
  background:radial-gradient(circle at 70% 40%,rgba(167,139,250,.22),transparent 60%);animation-duration:22s}
@keyframes float{to{transform:translate(2%,-3%) scale(1.05)}}

/* ===== HEADER (2 h√†ng) ===== */
.mast{
  max-width:1200px;
  margin:16px auto 8px;
  padding:10px 18px;
  display:flex; flex-direction:column;
  gap:4px; position:relative; z-index:1;
}
.mast .row{
  display:flex;
  align-items:baseline;           /* üîß c√πng b·∫±ng ch√¢n */
  justify-content:space-between;
}
.title{
  margin:0;
  font:900 24px "Merriweather",serif;
  line-height:1;                  /* gi√∫p baseline ·ªïn ƒë·ªãnh */
  cursor:pointer;
}
.now{
  font:700 clamp(10px, 2vw, 14px) "Inter";  /* üîß co gi√£n nh∆∞ tagline */
  line-height:1;                              
  color:var(--muted);
}
.tagline{
  font:700 clamp(10px, 2vw, 14px) "Inter";  /* üîß co gi√£n theo m√†n h√¨nh */
  color:var(--muted);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; /* lu√¥n 1 d√≤ng */
  text-align:left;
}

/* ===== TOOLBAR ===== */
.toolbar{
  max-width:1200px; margin:0 auto 10px; padding:0 18px;
  display:flex; gap:10px; align-items:center; flex-wrap:wrap; position:relative; z-index:1;
}
.input,.theme{display:flex; gap:8px; align-items:center; border:1px solid var(--border); background:var(--panel); padding:8px 10px; border-radius:12px}
.input{flex:1; min-width:260px}
.input input{width:100%; border:0; outline:0; background:transparent; color:var(--fg); font:600 14px "Inter"}
.input input::placeholder{color:var(--placeholder)}
.theme select{border:0; outline:0; background:transparent; color:var(--fg); font:700 13px "Inter"}

/* ===== GRID DANH S√ÅCH ===== */
.container{max-width:1200px; margin:0 auto; padding:0 18px}
.gridWrap{margin:0 auto 24px;}
.grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:14px}
.tile{
  padding:16px 14px; min-height:120px; display:flex; align-items:flex-start; gap:12px;
  background:var(--panel); border:1px solid var(--border); border-radius:16px; cursor:pointer; transition:all .25s;
}
.tile:hover{transform:translateY(-2px); background:rgba(255,255,255,.1)}
.dot{width:10px; height:10px; border-radius:50%; background:radial-gradient(circle at 30% 30%,var(--accent),var(--accent2)); margin-top:4px}
.tTitle{font:800 16px/1.45 "Inter"; color:var(--fg)}
.tMeta{font:700 11px/1 "Inter"; color:var(--muted); margin-top:8px}

/* ===== CH·∫æ ƒê·ªò ƒê·ªåC ===== */
.readWrap{padding:0 0 40px;}
.article{
  background:var(--readerBg); color:var(--fg);
  border:1px solid var(--border); border-radius:18px;
  box-shadow:0 40px 120px rgba(0,0,0,.6);
  cursor:pointer;            /* click anywhere to back */
}
.article header{padding:16px 16px 6px}
.article h2{margin:0; font:800 22px "Inter"}
.article .meta{font:700 12px "Inter"; color:var(--muted); padding:0 16px 10px}
.article .body{padding:0 16px 18px; font-size:16px; line-height:1.8; text-align:justify}
.article .body img{max-width:100%; height:auto}

/* ===== STATE ===== */
body.reading #listView{display:none}
body.reading #readView{display:block}
</style>
</head>
<body>
<div class="blob"></div><div class="blob b2"></div>

<header class="mast">
  <div class="row">
    <h1 class="title" id="siteTitle">NOFI.VN</h1>
    <div id="now" class="now"></div>
  </div>
  <div class="tagline">T√¥i nh∆∞ tr·∫ª nh·ªè ng·ªìi b√™n hi√™n nh√† ch·ªù nghe th·∫ø k·ª∑ t√†n phai</div>
</header>

<div class="toolbar">
  <div class="input">
    <input id="q" type="text" inputmode="search" autocomplete="off" autocorrect="off"
           autocapitalize="none" spellcheck="false"
           placeholder="T√¨m ti√™u ƒë·ªÅ‚Ä¶ (g√µ ƒë·ªÉ l·ªçc)">
  </div>
  <div class="theme">
    <label for="theme" style="font:700 12px 'Inter';opacity:.75;margin-right:4px">Giao di·ªán:</label>
    <select id="theme">
      <option value="glass">Glass Dark</option>
      <option value="sepia">Sepia Paper</option>
      <option value="neon">Neon Purple</option>
    </select>
  </div>
</div>

<!-- DANH S√ÅCH -->
<main id="listView" class="container gridWrap" aria-live="polite">
  <div id="loading">ƒêang t·∫£i b√†i‚Ä¶</div>
  <section id="grid" class="grid"></section>
</main>

<!-- ƒê·ªåC B√ÄI -->
<section id="readView" class="container readWrap" style="display:none">
  <article class="article" id="article">
    <header><h2 id="rTitle"></h2></header>
    <div id="rMeta" class="meta"></div>
    <div id="rBody" class="body"></div>
  </article>
</section>

<script>
/* ===== CONFIG ===== */
const BLOG_BASE="https://blognofivn.blogspot.com";
const WANT_MAX=80;

/* ===== INIT HEADER ===== */
document.getElementById('now').textContent=new Date().toLocaleString('vi-VN');

/* ===== THEME PERSIST ===== */
const root=document.documentElement,themeSelect=document.getElementById('theme');
(function(){
  const stored=localStorage.getItem('nofi_theme')||'glass';
  root.setAttribute('data-theme',stored);
  themeSelect.value=stored;
})();
themeSelect.addEventListener('change',()=>{
  root.setAttribute('data-theme',themeSelect.value);
  localStorage.setItem('nofi_theme',themeSelect.value);
});

/* ===== UTILS ===== */
const $=(s,el=document)=>el.querySelector(s);
const fmt=s=>s?new Date(s).toLocaleString('vi-VN'):'';
const norm=(s='')=>s.toLowerCase()
  .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
  .replace(/ƒë/g,'d').replace(/ƒê/g,'d');
const slugify=t=>encodeURIComponent(norm(t).trim().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,''));

/* ===== JSONP FETCH (Blogger) ===== */
function jsonp(url){return new Promise((resolve,reject)=>{
  const cb="cb_"+Math.random().toString(36).slice(2);
  const sc=document.createElement('script');
  sc.src=url+(url.includes('?')?'&':'?')+'callback='+cb;
  let done=false;
  window[cb]=(d)=>{done=true;resolve(d);cleanup();};
  sc.onerror=()=>{if(!done){reject(new Error('JSONP error'));cleanup();}};
  function cleanup(){delete window[cb];sc.remove();}
  document.body.appendChild(sc);
});}
async function fetchAllJSONP(base=BLOG_BASE,wanted=WANT_MAX){
  let url=base.replace(/\/?$/,'')+'/feeds/posts/default?alt=json-in-script&max-results=100';
  const out=[];
  for(let i=0;i<10 && out.length<wanted && url;i++){
    const d=await jsonp(url);
    const entries=(d.feed&&d.feed.entry)||[];
    out.push(...entries);
    const next=(d.feed&&d.feed.link||[]).find(l=>l.rel==='next');
    if(next&&next.href){
      url=next.href.replace('alt=json','alt=json-in-script');
      if(!/alt=json-in-script/.test(url)) url+=(url.includes('?')?'&':'?')+'alt=json-in-script';
    }else url=null;
  }
  return out.slice(0,wanted);
}

/* ===== SANITIZE + NORMALIZE ===== */
const SCRIPT_RE=/<script[\s\S]*?<\/script>/gi;
const STYLE_RE =/<style[\s\S]*?<\/style>/gi;
function sanitizeHTML(html=''){return (html||'').replace(SCRIPT_RE,'').replace(STYLE_RE,'');}
function normalize(e){
  const title=(e.title&&e.title.$t)||'(Kh√¥ng ti√™u ƒë·ªÅ)';
  const html=(e.content&&e.content.$t)||(e.summary&&e.summary.$t)||'';
  return {title,published:e.published?e.published.$t:'',html:sanitizeHTML(html)};
}

/* ===== STATE ===== */
let POSTS=[], SLUG_INDEX=new Map();

/* ===== RENDER GRID ===== */
function renderGrid(list){
  const grid=$('#grid'); grid.innerHTML='';
  list.forEach(p=>{
    const tile=document.createElement('article');
    tile.className='tile';
    tile.innerHTML=`<div class="dot"></div>
      <div style="min-width:0">
        <div class="tTitle">${p.title}</div>
        <div class="tMeta">${fmt(p.published)}</div>
      </div>`;
    tile.addEventListener('click',()=>openArticle(p,true));
    grid.appendChild(tile);
  });
}

/* ===== SEARCH FILTER ===== */
const qEl=document.getElementById('q'); let composing=false, rafId=0;
function runFilter(){
  cancelAnimationFrame(rafId);
  rafId=requestAnimationFrame(()=>{
    const kw=norm(qEl.value.trim());
    const filtered=kw?POSTS.filter(p=>norm(p.title).includes(kw)):POSTS;
    renderGrid(filtered);
    if(document.body.classList.contains('reading')) goList(false); // ƒëang ƒë·ªçc -> v·ªÅ list khi g√µ
  });
}
qEl.addEventListener('compositionstart',()=>{composing=true;});
qEl.addEventListener('compositionend',()=>{composing=false;runFilter();});
qEl.addEventListener('input',()=>{if(!composing)runFilter();},{passive:true});
qEl.addEventListener('keyup',()=>{if(!composing)runFilter();},{passive:true});
qEl.addEventListener('search',runFilter,{passive:true});

/* ===== NAV: LIST <-> READ ===== */
function goList(push=true){
  document.body.classList.remove('reading');
  $('#readView').style.display='none';
  if(push){ history.pushState({view:'list'},'',location.pathname); }
}
function openArticle(p, pushHistory=false){
  $('#rTitle').textContent=p.title||'(Kh√¥ng ti√™u ƒë·ªÅ)';
  $('#rMeta').textContent=fmt(p.published);
  $('#rBody').innerHTML=p.html||'';
  document.body.classList.add('reading');
  $('#readView').style.display='block';
  if(pushHistory){ history.pushState({view:'read'},'',`#${slugify(p.title)}`); }
}

/* Click logo -> v·ªÅ danh s√°ch; Click B·∫§T K·ª≤ ƒê√ÇU trong b√†i -> v·ªÅ danh s√°ch */
document.getElementById('siteTitle').addEventListener('click',()=>goList());
$('#article').addEventListener('click',()=>goList());

/* Back/Forward theo hash */
window.addEventListener('popstate',()=>{
  if(location.hash){
    const p=SLUG_INDEX.get(decodeURIComponent(location.hash.slice(1)));
    if(p){ openArticle(p,false); return; }
  }
  goList(false);
});

/* ===== BOOT ===== */
(async()=>{
  try{
    const raw=await fetchAllJSONP(BLOG_BASE,WANT_MAX);
    POSTS=raw.map(normalize).sort((a,b)=>new Date(b.published)-new Date(a.published));
    POSTS.forEach(p=>SLUG_INDEX.set(slugify(p.title),p));
    document.getElementById('loading')?.remove();
    renderGrid(POSTS);

    // n·∫øu URL ƒë√£ c√≥ hash -> m·ªü ƒë√∫ng b√†i
    if(location.hash){
      const p=SLUG_INDEX.get(decodeURIComponent(location.hash.slice(1)));
      if(p) openArticle(p,false);
    }else{
      history.replaceState({view:'list'},'',location.pathname);
    }
  }catch(err){
    document.getElementById('loading').textContent='L·ªói t·∫£i (JSONP): '+err.message;
  }
})();
</script>
</body>
</html>
